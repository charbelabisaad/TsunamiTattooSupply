@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
    Layout = "_LayoutAdmin";
    ViewData["Title"] = "User Accounts";
}

<partial name="SaveUser" />

<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0">@ViewData["Title"]</h1>
                </div><!-- /.col -->
            </div><!-- /.row -->
        </div><!-- /.container-fluid -->
    </div>
    <!-- /.content-header -->
    <!-- Main content -->
    <section class="content">
        <div class="container-fluid">

            <div class="card">
                <div class="card-header">
                    <div class="row">
						<div class="col-6 d-flex align-items-center"><h3 class="card-title">Users List</h3></div>
                        <div class="col-6 d-flex align-items-center justify-content-end">
							<button id="btnNewUser" type="button" class="btn btn-sm btn-dark btn-black"><i class="fas fa-plus"></i> Add New User</button>
                        </div>
                    </div>
                    
                </div>

				<div class="card-body p-0">
                            
                    <div class="col-sm-12 mt-3">
                        <table id="tableUsers" class="table table-striped w-100 ">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>First Name</th>
                                    <th>Last Name</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th class="no-export">Actions</th>
                                </tr>
                            </thead>
                        </table>

                    </div>
                        
                </div>
               
            </div>

        </div>
    </section>

</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            var table = $('#tableUsers').DataTable({
                processing: true,
                responsive: true,
                ajax: {
                    url: '@Url.Action("GetUsers", "UserAccounts")',
                    type: 'GET'
                },
                dom: '<"row mb-2"<"col-md-6"f><"col-md-6 text-right"B>>t<"row mt-2"<"col-md-6"l><"col-md-6 text-right"ip>>',
                language: {
                    search: "",
                    searchPlaceholder: "Search users..."
                },
                buttons: [
                    { extend: 'copy', className: 'btn btn-secondary btn-sm', exportOptions: { columns: ':visible:not(.no-export)' } },
                    { extend: 'excel', className: 'btn btn-success btn-sm', exportOptions: { columns: ':visible:not(.no-export)' } },
                    { extend: 'pdf', className: 'btn btn-danger btn-sm', exportOptions: { columns: ':visible:not(.no-export)' } },
                    { extend: 'print', className: 'btn btn-dark btn-sm', exportOptions: { columns: ':visible:not(.no-export)' } },
                    {
                        text: '<i class="fas fa-sync"></i> Refresh',
                        className: 'btn btn-primary btn-sm',
                        action: function () {
                            table.ajax.reload();
                        }
                    }
                ],
                columns: [
                    { data: 'username' },
                    { data: 'firstName' },
                    { data: 'lastName' },
                    { data: 'userType' },
                    { data: 'status' },
                    {
                        data: null,
                        orderable: false,
                        searchable: false,
                        className: "no-export",
                        render: function (data, type, row) {
                            return `
                        <div class="dropdown">
                            <button class="btn btn-sm btn-light" type="button" data-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <div class="dropdown-menu">
                                <a class="dropdown-item btnEdit" href="#" data-id="{{row.id}}">
                                    <i class="fas fa-edit"></i> Edit
                                </a>
                                <a class="dropdown-item btnDelete" href="#" data-id="{{row.id}}">
                                    <i class="fas fa-trash"></i> Delete
                                </a>
                            </div>
                        </div>
                            `;
                        }
                    }
                ]
            });

            // place export buttons next to search bar
            table.buttons().container().appendTo('#tableUsers_wrapper .col-md-6:eq(1)');


        var $filter = $('#tableUsers_filter');

        $filter.css("position", "relative");

        // Insert FA icons
       
        $filter.append('<i class="fas fa-times" id="clearSearch"></i>');

        // Toggle X on typing
        $('#tableUsers_filter input').on("input", function () {
            if ($(this).val().length > 0) {
                $('#clearSearch').show();
            } else {
                $('#clearSearch').hide();
            }
        });

        // Clear on X click
        $('#clearSearch').on("click", function () {
            $('#tableUsers_filter input').val('');
            table.search('').draw();
            $(this).hide();
        });

        });
      
    </script>
}








